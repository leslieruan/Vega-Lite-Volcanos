{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "data": {
      "url": "https://raw.githubusercontent.com/leslieruan/Vega-Lite-Volcanos/main/volcanos_eruptions.csv",
      "format": {"type": "csv"}
    },
    "params": [{"name": "interpolate", "value": "monotone"},
    {
        "name": "min_year",
        "value": 1700,
        "bind": {"input": "range", "min": 0, "max": 2020, "step": 10}
      },
      {
        "name": "max_year",
        "value": 2020,
        "bind": {"input": "range", "min": 0, "max": 2020, "step": 10}
      },
      {
        "name": "use_custom_year_range",
        "value": true,
        "bind": {"input": "checkbox"}
      }
    
],
    "title": {
      "text": "Exploring the Volcanos of the World",
      "anchor": "middle",
      "fontWeight": "bold",
      "fontSize": 24,
      "offset": 40,
      "subtitle": "*DATA SOURCE: https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-05-12",
      "subtitleFontSize": 10,
      "subtitlePadding": 10,
      "subtitleColor": "dimgrey"
    },
    "config": {
      "axisY": {"minExtent": 0},
      "axis": {
        "titleFontWeight": "bold",
        "titleFontSize": 14,
        "gridColor": "#EFEFEF"
      }
    },
    "vconcat": [
      {
        "hconcat": [
          {
           
            "layer": [
                {
                    "mark": {
                      "type": "geoshape",
                      "fill": "#ddd",
                      "stroke": "#fff",
                      "strokeWidth": 1
                    },
                    "data": {
                      "url": "https://raw.githubusercontent.com/brechtv/looker_map_layers/master/world-countries-sans-antarctica.json",
                      "format": {"type": "topojson", "feature": "countries1"}
                    }
                  },
                  {
                    "mark": {"type": "circle"},
                    "encoding": {
                      "longitude": {"field": "longitude", "type": "quantitative"},
                      "latitude": {"field": "latitude", "type": "quantitative"},
                      "size": {"value": 30},
                      "color": {
                        "field": "eruption_frequency",
                        "title": "Eruptio Frequency",
                        "type": "nominal",
                        "scale": {"range": [ "#d62828", "#ff7f0e", "#ffd60a"]}
                        },
                        "opacity": {
                            "condition": {"param": "legend_click", "value": 0.7},
                            "value": 0
                          },
    
                      "tooltip": [
                        {"field": "volcano_name", "type": "nominal", "title": "Volcano Name"},
                        {"field": "country", "type": "nominal", "title": "Country"},
                        {"field": "tectonic_settings", "type": "nominal", "title": "Tectonic Setting"},
                        {"field": "eruption_times", "type": "quantitative", "title": "Eruption Times"},
                        {"field": "primary_volcano_type", "type": "nominal", "title": "Primary Volcano Type"}
                      ]
                    },
                    "params": [
                        {
                          "name": "legend_click",
                          "select": {
                            "fields": ["eruption_frequency"],
                            "type": "point",
                            "toggle": "event.shiftKey"
                          },
                          "bind": "legend"
                        }
                      ],
                      "transform": [
                        {"filter": {"param": "scatter_plot_brush"}},
                        {"filter": {"not": {"field": "volcanos_name", "equal": "NA"}}},
                        {"filter": {"param": "bar_chart_click"}},       
                        {"filter": {"param": "histogram_brush"}}
                      ]
                  }
              
            ],
            "projection": {"type": "equirectangular"},
            "width": 400,
            "height": 200
          },
          {
            "width": 200,
            "height": 200,
            "mark": {"type": "bar", "size": 10},
            "encoding": {
              "x": {
                "title": "Number of Vocanoes",
                "aggregate": "count",
                "field": "volcano_name",
                "type": "quantitative"
              },
              "y": {
                "title": "Volcano Type",
                "field": "primary_volcano_type",
                "type": "nominal",
                "sort": "-x"
              },
              "color": {"field": "eruption_frequency"},
              "opacity": {"condition": {"param": "histogram_brush"}, "value": 0.2}
            },
            "params": [
              {
                "name": "histogram_brush",
                "select": {
                  "type": "point",
                  "toggle": "event.shiftKey",
                  "encodings": ["y"]
                }
              }
            ],
            "transform": [
                {"filter": {"not": {"field": "eruption_frequency", "equal": "NA"}}},
                {"filter": {"param": "legend_click"}},
                {"filter": {"param": "scatter_plot_brush"}},
                {"filter": {"param": "bar_chart_click"}}       
            ]
          }  
        ]
      },
      {
        "hconcat": [
            {
            "layer": [

                {
                    "width": 400,
                    "height": 200,
                    "mark": {"type": "circle", "opacity": 0.8, "size": 25},
                    "encoding": {
                      "x": {
                        "title": "Eruption Start Time",
                        "field": "eruption_start_time",
                        "timeUnit": "year",
                        "type": "temporal",
                        "scale": {
                            "domainRaw": {"expr": "use_custom_year_range ? [min_year, max_year] : null"}
                          },
                        "axis": {"tickCount": {"interval": "year", "step": 50}}
                        
                        
                      },
                      "y": {
                        "title": "Eruption Times",
                        "field": "eruption_times",
                        "type": "quantitative"
                      },
                      
                      "color": {"field": "eruption_frequency"},
                      "opacity": {
                        "condition": {"param": "scatter_plot_brush"},
                        "value": 0.2
                      },
                      "tooltip": [
                        {"field": "volcano_name", "type": "nominal", "title": "Volcano Name"},
                        {"field": "country", "type": "nominal", "title": "Country"},
                        {"field": "tectonic_settings", "type": "nominal", "title": "Tectonic Setting"},
                        {"field": "eruption_times", "type": "quantitative", "title": "Eruption Times"},
                        {"field": "primary_volcano_type", "type": "nominal", "title": "Primary Volcano Type"}
                      ]
                    },
                    "params": [
                      {
                        "name": "scatter_plot_brush",
                        "select": {"type": "interval", "encodings": ["x"]}
                        
                      }
                      
                    ],
                    "transform": [
                      {"filter": {"not": {"field": "eruption_start_time", "equal": "NA"}}},
                      {"filter": {"param": "legend_click"}},
                      {"filter": {"param": "histogram_brush"}},
                      {"filter": {"param": "bar_chart_click"}}       
                    ]
                  },
                  {
                    "mark": {
                      "type": "line",
                      "interpolate": {"expr": "interpolate"},
                      "color": "#8338ec"
                    },
                    "transform": [
                      {"filter": {"not": {"field": "eruption_times", "equal": "NA"}}},
                      {
                        "joinaggregate": [
                          {"op": "mean", "field": "eruption_times", "as": "mean_times"}
                        ],
                        "groupby": ["eruption_start_year"]
                       
                      },
                    
                      {"filter": {"param": "scatter_plot_brush"}},
                      {"filter": {"param": "legend_click"}},
                      {"filter": {"param": "bar_chart_click"}},       
                      {"filter": {"param": "histogram_brush"}}
                    ],
                    "encoding": {
                      "x": {
                        "title": "Year",
                        "field": "eruption_start_time",
                        "timeUnit": "year",
                        "type": "temporal",
                        "axis": {"tickCount": {"interval": "year", "step": 50}}       
                      },
                      "y": {
                        "title": "Average Eruption Times",
                        "field": "mean_times",
                        "type": "quantitative"
                      }
                    }
                  }

            ]
            },
            {
                "repeat": {"column": ["eruption_times"]},
                "spec": {
                  "height": 200,
                  "width": 300,
                  "layer": [
                    {
                      "params": [
                        {
                          "name": "bar_chart_click",
                          "select": {"type": "interval", "encodings": ["x"]}
                        }
                      ],
                      "mark": "bar",
                      "encoding": {
                        "y": {
                          "title": "Number of Volcanoes",
                          "aggregate": "count",
                          "field": "volcano_name",
                          "type": "quantitative"
                        },
                        "x": {
                          "title": "Eruption Times",
                          "field": {"repeat": "column"},
                          "bin": {"step": 5}
                        },
                        "color": {"field": "eruption_frequency"},
                        "opacity": {
                          "condition": {"param": "bar_chart_click"},
                          "value": 0.1
                        }
                      },
                      "transform": [
                        {"filter": {"param": "scatter_plot_brush"}},
                        {"filter": {"param": "legend_click"}},
                        {"filter": {"param": "bar_chart_click"}},       
                        {"filter": {"param": "histogram_brush"}}
                      ]
                    },
                    {
                      "mark": "bar",
                      "encoding": {
                        "x": {"field": {"repeat": "column"}, "bin": {"step": 5}},
                        "y": {"aggregate": "count"},
                        "color": {"field": "eruption_frequency"}
                      },
                      "transform": [
                        {"filter": {"param": "bar_chart_click"}},
                        {"filter": {"param": "scatter_plot_brush"}},
                        {"filter": {"param": "legend_click"}},
                        {"filter": {"param": "histogram_brush"}}
                      ]
                    }
                  ]
                }
              }
        ]
      }     
    ]
  }
  