{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "data": {
      "url": "https://raw.githubusercontent.com/leslieruan/Vega-Lite-Volcanos/main/volcanos_eruptions.csv",
      "format": {"type": "csv"}
    },
    "params": [{"name": "interpolate", "value": "monotone"}
    
   
    
],
    "title": {
      "text": "Exploring the Volcanos of the World",
      "anchor": "middle",
      "fontWeight": "bold",
      "fontSize": 24,
      "offset": 40,
      "subtitle": "*DATA SOURCE: https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-05-12",
      "subtitleFontSize": 10,
      "subtitlePadding": 10,
      "subtitleColor": "dimgrey"
    },
    "config": {
      "axisY": {"minExtent": 0},
      "axis": {
        "titleFontWeight": "bold",
        "titleFontSize": 14,
        "gridColor": "#EFEFEF"
      }
    },
    "vconcat": [
      {
        "hconcat": [
          {
           
            "layer": [
                {
                    "mark": {
                      "type": "geoshape",
                      "fill": "#ddd",
                      "stroke": "#fff",
                      "strokeWidth": 1
                    },
                    "data": {
                      "url": "https://raw.githubusercontent.com/brechtv/looker_map_layers/master/world-countries-sans-antarctica.json",
                      "format": {"type": "topojson", "feature": "countries1"}
                    }
                  },
                  {
                    "mark": {"type": "circle"},
                    "encoding": {
                      "longitude": {"field": "longitude", "type": "quantitative"},
                      "latitude": {"field": "latitude", "type": "quantitative"},
                      "size": {"value": 30},
                      "color": {
                        "field": "eruption_frequency",
                        "title": "Eruptio Frequency",
                        "type": "nominal",
                        "scale": {"range": [ "#ffd60a", "#7cb518", "#1982c4"]}
                        },
                        "opacity": {
                            "condition": {"param": "legend_click", "value": 0.7},
                            "value": 0
                          },
    
                      "tooltip": [
                        {"field": "volcano_name", "type": "nominal", "title": "Volcano Name"},
                        {"field": "country", "type": "nominal", "title": "Country"},
                        {"field": "tectonic_settings", "type": "nominal", "title": "Tectonic Setting"},
                        {"field": "eruption_times", "type": "quantitative", "title": "Eruption Times"},
                        {"field": "primary_volcano_type", "type": "nominal", "title": "Primary Volcano Type"}
                      ]
                    },
                    "params": [
                        {
                          "name": "legend_click",
                          "select": {
                            "fields": ["eruption_frequency"],
                            "type": "point",
                            "toggle": "event.shiftKey"
                          },
                          "bind": "legend"
                        }
                      ],
                      "transform": [
                        {"filter": {"param": "scatter_plot_brush"}},
                        {"filter": {"not": {"field": "volcanos_name", "equal": "NA"}}},
                        {"filter": {"param": "bar_chart_click"}},       
                        {"filter": {"param": "histogram_brush"}}
                      ]
                  }
              
            ],
            "projection": {"type": "equirectangular"},
            "width": 400,
            "height": 200
          },
          {
            "width": 200,
            "height": 200,
            "mark": {"type": "bar", "size": 10},
            "encoding": {
              "x": {
                "title": "Number of Vocanoes",
                "aggregate": "count",
                "field": "volcano_name",
                "type": "quantitative"
              },
              "y": {
                "title": "Volcano Type",
                "field": "primary_volcano_type",
                "type": "nominal",
                "sort": "-x"
              },
              "color": {"field": "eruption_frequency"},
              "opacity": {"condition": {"param": "histogram_brush"}, "value": 0.2}
            },
            "params": [
              {
                "name": "histogram_brush",
                "select": {
                  "type": "point",
                  "toggle": "event.shiftKey",
                  "encodings": ["y"]
                }
              }
            ],
            "transform": [
                {"filter": {"not": {"field": "eruption_frequency", "equal": "NA"}}},
                {"filter": {"param": "legend_click"}},
                {"filter": {"param": "scatter_plot_brush"}},
                {"filter": {"param": "bar_chart_click"}}       
            ]
          }  
        ]
      },
      {
        "hconcat": [
            {
            "layer": [

                {
                    "width": 400,
                    "height": 200,
                    
                    "mark": {"type": "line", "interpolate": {"expr": "interpolate"}},
                    "encoding": {
                      "x": {
                        "title": "Eruption Start Time",
                        "field": "eruption_start_year",
                        "type": "quantitative",
                        "scale": {
                            "type": "piecewise",
                            "domain": [1700, 1900, 2020],
                            "range": [0, 100, 400]
                          }
                      },
                      "y": {
                        "title": "Eruption Times",
                        "field": "eruption_times",
                        "type": "quantitative",
                        "scale": {
                            "type": "piecewise",
                            "domain": [250, 100, 0],
                            "range": [0, 40, 200]
                          }
                        
                      },
                      
                      "color": {"field": "eruption_frequency"},
                      "opacity": {
                        "condition": {"param": "scatter_plot_brush"},
                        "value": 0.2
                      },
                      "tooltip": [
                        {"field": "volcano_name", "type": "nominal", "title": "Volcano Name"},
                        {"field": "country", "type": "nominal", "title": "Country"},
                        {"field": "tectonic_settings", "type": "nominal", "title": "Tectonic Setting"},
                        {"field": "eruption_times", "type": "quantitative", "title": "Eruption Times"},
                        {"field": "primary_volcano_type", "type": "nominal", "title": "Primary Volcano Type"}
                      ]
                    },
                    "params": [
                      {
                        "name": "scatter_plot_brush",
                        "select": {"type": "interval", "encodings": ["x"]}
                        
                      }
                      
                    ],
                    "transform": [
                      {"filter": {"not": {"field": "eruption_start_time", "equal": "NA"}}},
                      {"filter": {"param": "legend_click"}},
                      {"filter": {"param": "histogram_brush"}},
                      {"filter": {"param": "bar_chart_click"}}       
                    ]
                  },
                  {
                    "mark": {
                      "type": "line", 
                      "interpolate": {"expr": "interpolate"},
                      "color": "#ef476f"
                    },
                    "transform": [
                      {"filter": {"not": {"field": "eruption_times", "equal": "NA"}}},
                      {
                        "joinaggregate": [
                          {"op": "mean", "field": "eruption_times", "as": "mean_times"}
                        ],
                        "groupby": ["eruption_start_year"]
                       
                      },
                    
                      {"filter": {"param": "scatter_plot_brush"}},
                      {"filter": {"param": "legend_click"}},
                      {"filter": {"param": "bar_chart_click"}},       
                      {"filter": {"param": "histogram_brush"}}
                    ],
                    "encoding": {
                      "x": {
                        "title": "Year",
                        "field": "eruption_start_year",
                        "type": "quantitative",
                        "scale": {
                            "type": "piecewise",
                            "domain": [1700, 1900, 2020],
                            "range": [0, 100, 400]
                          }

                      },
                      "y": {
                        "title": "Average Eruption Times",
                        "field": "mean_times",
                        "type": "quantitative",
                        "scale": {
                            "type": "piecewise",
                            "domain": [250, 100, 0],
                            "range": [0, 40, 200]
                          }
                        
                      }
                    }
                  }

            ]
            },
            {
                "width": 200,
                "height": 200,
                "mark": "bar",
                "encoding": {
                  "y": {
                    "field": "primary_volcano_type",
                    "type": "nominal",
                    "title": "Volcano Type"
                  },
                  "x": {
                    "aggregate": "average",
                    "field": "vei",
                    "type": "quantitative",
                    "title": "Average Eruption VEI"
                  },
                  "color": {
                    "field": "eruption_frequency",
                    "type": "nominal"
                  }
                },
                "params": [
                  {
                    "name": "bar_chart_click",
                    "select": {"type": "interval", "encodings": ["x"]}
                  }
                ],
                "transform": [
                  {"filter": {"param": "scatter_plot_brush"}},
                  {"filter": {"param": "legend_click"}},
                  {"filter": {"param": "bar_chart_click"}},
                  {"filter": {"param": "histogram_brush"}}
                ]
              }
              

        ]
      }     
    ]
  }
  